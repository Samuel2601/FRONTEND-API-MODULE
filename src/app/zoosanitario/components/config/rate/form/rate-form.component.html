<form [formGroup]="rateForm" (ngSubmit)="onSubmit()" class="rate-form">
    <div class="grid">
        <!-- Información Básica -->
        <div class="col-12">
            <h6 class="section-title">Información Básica</h6>
        </div>

        <div class="col-12 md:col-6">
            <label for="code" class="block text-900 text-xl font-medium mb-2">
                Código <span class="required">*</span>
            </label>
            <input
                id="code"
                type="text"
                formControlName="code"
                pInputText
                class="w-full"
                [class.ng-invalid]="isFieldInvalid('code')"
                placeholder="Ej: TAS001"
                (blur)="onCodeBlur()"
                maxlength="20"
                style="text-transform: uppercase"
            />
            <small class="p-error block mt-1" *ngIf="isFieldInvalid('code')">
                {{ codeErrors }}
            </small>
        </div>

        <div class="col-12 md:col-6">
            <label
                for="position"
                class="block text-900 text-xl font-medium mb-2"
            >
                Posición <span class="required">*</span>
            </label>
            <p-inputNumber
                id="position"
                formControlName="position"
                class="w-full"
                [class.ng-invalid]="isFieldInvalid('position')"
                [min]="1"
                [max]="100"
                [step]="1"
                placeholder="Posición en el listado"
            >
            </p-inputNumber>
            <small
                class="p-error block mt-1"
                *ngIf="isFieldInvalid('position')"
            >
                {{ getFieldError("position") }}
            </small>
        </div>

        <div class="col-12">
            <label
                for="description"
                class="block text-900 text-xl font-medium mb-2"
                >Descripción <span class="required">*</span></label
            >
            <textarea
                id="description"
                formControlName="description"
                pInputTextarea
                class="w-full"
                rows="3"
                [class.ng-invalid]="isFieldInvalid('description')"
                placeholder="Descripción detallada del concepto de cobro"
                maxlength="1000"
            >
            </textarea>
            <small
                class="p-error block mt-1"
                *ngIf="isFieldInvalid('description')"
            >
                {{ getFieldError("description") }}
            </small>
        </div>

        <div class="col-12">
            <label
                for="rubroxAtributo"
                class="block text-900 text-xl font-medium mb-2"
            >
                Rubro x Atributo <span class="required">*</span>
            </label>
            <input
                id="rubroxAtributo"
                type="text"
                formControlName="rubroxAtributo"
                pInputText
                class="w-full"
                [class.ng-invalid]="isFieldInvalid('rubroxAtributo')"
                placeholder="Atributo de rubro"
            />
            <small
                class="p-error block mt-1"
                *ngIf="isFieldInvalid('rubroxAtributo')"
            >
                {{ getFieldError("rubroxAtributo") }}
            </small>
        </div>

        <!-- Clasificación -->
        <div class="col-12">
            <h6 class="section-title">Clasificación</h6>
        </div>

        <div class="col-12 md:col-4">
            <label for="type" class="block text-900 text-xl font-medium mb-2">
                Tipo <span class="required">*</span>
            </label>
            <p-dropdown
                id="type"
                formControlName="type"
                [options]="typeOptions"
                placeholder="Seleccionar tipo"
                class="w-full"
                [class.ng-invalid]="isFieldInvalid('type')"
            >
            </p-dropdown>
            <small class="p-error block mt-1" *ngIf="isFieldInvalid('type')">
                {{ getFieldError("type") }}
            </small>
        </div>

        <div class="col-12 md:col-4">
            <label
                for="personType"
                class="block text-900 text-xl font-medium mb-2"
            >
                Tipo de Persona
            </label>
            <p-multiSelect
                id="personType"
                formControlName="personType"
                [options]="personTypeOptions"
                placeholder="Seleccionar tipos"
                class="w-full"
                [showHeader]="false"
                [showToggleAll]="true"
                (onChange)="onPersonTypeChange($event)"
            >
            </p-multiSelect>
            <small class="text-600 block mt-1">
                Por defecto se aplica a ambos tipos
            </small>
        </div>

        <div class="col-12 md:col-4">
            <label
                for="animalTypes"
                class="block text-900 text-xl font-medium mb-2"
            >
                Tipos de Animal <span class="required">*</span>
            </label>
            <p-multiSelect
                id="animalTypes"
                formControlName="animalTypes"
                [options]="animalTypeOptions"
                optionLabel="label"
                optionValue="value"
                placeholder="Seleccionar animales"
                class="w-full"
                [class.ng-invalid]="isFieldInvalid('animalTypes')"
                [showHeader]="false"
                [showToggleAll]="true"
                (onChange)="onAnimalTypesChange($event)"
            >
            </p-multiSelect>
            <small
                class="p-error block mt-1"
                *ngIf="isFieldInvalid('animalTypes')"
            >
                {{ getFieldError("animalTypes") }}
            </small>
        </div>

        <!-- Botones de acción -->
        <div class="col-12">
            <div class="flex justify-content-end gap-2 mt-4">
                <button
                    type="button"
                    pButton
                    pRipple
                    label="Cancelar"
                    icon="pi pi-times"
                    class="p-button-outlined p-button-secondary"
                    (click)="onCancel()"
                    [disabled]="loading"
                ></button>
                <button
                    type="submit"
                    pButton
                    pRipple
                    [label]="isEditMode ? 'Actualizar' : 'Crear'"
                    [icon]="
                        loading
                            ? 'pi pi-spin pi-spinner'
                            : isEditMode
                            ? 'pi pi-check'
                            : 'pi pi-plus'
                    "
                    class="p-button-success"
                    [disabled]="loading"
                ></button>
            </div>
        </div>
    </div>

    <!-- Toast para mensajes -->
    <p-toast></p-toast>
</form>
