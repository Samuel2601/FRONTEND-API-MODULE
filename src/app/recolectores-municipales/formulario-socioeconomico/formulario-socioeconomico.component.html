<p-toast></p-toast>
<form action="" [formGroup]="registrationForm">
    <p-panel
        header="Información de Registro"
        formGroupName="informacionRegistro"
    >
        <div class="col-6">
            <div class="p-field">
                <div class="col-2">
                    <label for="date">Fecha</label>
                </div>
                <div class="col-3">
                    <input
                        id="date"
                        pInputText
                        type="date"
                        formControlName="date"
                    />
                </div>
            </div>
        </div>
        <div class="col-6">
            <div class="p-field">
                <label for="encuestador">Encuestador</label>
                <input
                    id="encuestador"
                    pInputText
                    formControlName="encuestador"
                />
            </div>
        </div>
    </p-panel>

    <p-panel
        header="Información Personal"
        formGroupName="informacionPersonal"
        styleClass="p-panel-content-custom"
    >
        <div class="col-6">
            <div class="p-field">
                <label for="entrevistado">Entrevistado</label>
                <input
                    id="entrevistado"
                    pInputText
                    formControlName="entrevistado"
                />
            </div>
        </div>
        <div class="col-6">
            <div class="p-field">
                <label for="dni">Nº Cédula</label>
                <input id="dni" pInputText formControlName="dni" />
            </div>
        </div>

        <div class="col-6">
            <div class="p-field">
                <label for="edad">Edad</label>
                <input
                    id="edad"
                    pInputText
                    type="number"
                    formControlName="edad"
                />
            </div>
        </div>

        <div class="col-6">
            <div class="p-field">
                <label for="nacionalidad">Nacionalidad</label>
                <input
                    id="nacionalidad"
                    pInputText
                    formControlName="nacionalidad"
                />
            </div>
        </div>

        <div class="col-6">
            <div class="p-field">
                <label for="phone">Teléfono</label>
                <input id="phone" pInputText formControlName="phone" />
            </div>
        </div>
    </p-panel>

    <p-panel
        header="Información de Ubicación"
        formGroupName="informacionUbicacion"
    >
        <div class="p-field">
            <label for="posesionTime">Tiempo de Posesión</label>
            <input
                id="posesionTime"
                pInputText
                formControlName="posesionTime"
            />
        </div>
        <div class="p-field">
            <label for="sector">Sector</label>
            <input id="sector" pInputText formControlName="sector" />
        </div>
        <div class="p-field">
            <label for="barrio">Barrio</label>
            <input id="barrio" pInputText formControlName="barrio" />
        </div>
        <div class="p-field">
            <label for="manzana">Manzana</label>
            <input id="manzana" pInputText formControlName="manzana" />
        </div>
        <div class="p-field">
            <label for="lotenumero">Lote Número</label>
            <input id="lotenumero" pInputText formControlName="lotenumero" />
        </div>
        <div class="p-field">
            <label for="familyCount"
                >¿Cuántas familias viven en el hogar?
            </label>
            <input
                id="familyCount"
                pInputText
                type="number"
                formControlName="familyCount"
            />
        </div>
        <div class="p-field">
            <label for="peopleCount"
                >¿Cuántas personas viven en el hogar?</label
            >
            <input
                id="peopleCount"
                pInputText
                type="number"
                formControlName="peopleCount"
            />
        </div>
        <div class="p-field">
            <label for="houseState">Estado actual de la Vivienda</label>
            <p-dropdown
                [options]="houseStateOptions"
                formControlName="houseState"
                placeholder="Seleccione el estado"
            ></p-dropdown>
        </div>
    </p-panel>

    <p-panel header="Información de Salud" formGroupName="salud">
        <div class="p-field">
            <label for="estadoSalud"
                >¿Cómo usted evalúa su estado de salud?</label
            >
            <p-dropdown
                [options]="estadoSaludOptions"
                formControlName="estadoSalud"
                placeholder="Seleccione el estado"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="causasSalud"
                >En su opinión, ¿cuáles son las causas de su problema de salud?
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="causasSaludOptions"
                formControlName="causasSalud"
                placeholder="Seleccione las causas"
            ></p-multiSelect>
        </div>
        <div class="p-field">
            <label for="conexionHigienico"
                >El servicio higiénico que tiene en su vivienda está conectado
                a:
            </label>
            <p-dropdown
                [options]="conexionHigienicoOptions"
                formControlName="conexionHigienico"
                placeholder="Seleccione la conexión"
            ></p-dropdown>
        </div>
    </p-panel>

    <p-panel header="Información de Vivienda" formGroupName="vivienda">
        <div class="p-field">
            <label for="estructuraVivienda">Estructura de la Vivienda</label>
            <p-dropdown
                [options]="estructuraViviendaOptions"
                formControlName="estructuraVivienda"
                placeholder="Seleccione la estructura"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="serviciosBasicos"
                >¿Cuáles de los siguientes servicios básicos Ud. Dispone?
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="serviciosBasicosOptions"
                formControlName="serviciosBasicos"
                placeholder="Seleccione los servicios"
            ></p-multiSelect>
        </div>
        <div class="p-field">
            <label for="tenenciaVivienda">La tenencia de la vivienda es</label>
            <p-dropdown
                [options]="tenenciaViviendaOptions"
                formControlName="tenenciaVivienda"
                placeholder="Seleccione la tenencia"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="documentosPropiedad"
                >Qué documentos relativos a la propiedad usted tiene:
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="documentosPropiedadOptions"
                formControlName="documentosPropiedad"
                placeholder="Seleccione los documentos"
            ></p-multiSelect>
        </div>
        <div class="p-field">
            <label for="numPisos">¿Cuántos pisos posee la vivienda? </label>
            <input
                type="number"
                pInputText
                formControlName="numPisos"
                placeholder="Ingrese el número de pisos"
            />
        </div>
        <div class="p-field">
            <label for="numHabitaciones"
                >¿Cuántas habitaciones posee la vivienda?
            </label>
            <input
                type="number"
                pInputText
                formControlName="numHabitaciones"
                placeholder="Ingrese el número de habitaciones"
            />
        </div>
        <div class="p-field">
            <label for="tipoAlumbrado">Tipo de alumbrado de la Vivienda</label>
            <p-dropdown
                [options]="tipoAlumbradoOptions"
                formControlName="tipoAlumbrado"
                placeholder="Seleccione el tipo de alumbrado"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="abastecimientoAgua"
                >¿Cómo se abastece con el agua?
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="abastecimientoAguaOptions"
                formControlName="abastecimientoAgua"
                placeholder="Seleccione el abastecimiento de agua"
            ></p-multiSelect>
        </div>
        <div class="p-field">
            <label for="bienesServiciosElectrodomesticos"
                >¿Cuáles de los siguientes servicios electrodomésticos Ud.
                Dispone?
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="bienesServiciosElectrodomesticosOptions"
                formControlName="bienesServiciosElectrodomesticos"
                placeholder="Seleccione los servicios"
            ></p-multiSelect>
        </div>
        <div class="p-field">
            <label for="zonaRiesgo"
                >¿Su vivienda se encuentra en una zona de riesgo?</label
            >
            <p-dropdown
                [options]="zonaRiesgoOptions"
                formControlName="zonaRiesgo"
                placeholder="Seleccione la zona de riesgo"
            ></p-dropdown>
        </div>
    </p-panel>

    <p-panel header="Medios de Vida" formGroupName="mediosDeVida">
        <div class="p-field">
            <label for="participacionCapacitacion"
                >Ha participado en algún tipo de capacitación</label
            >
            <p-dropdown
                [options]="participacionCapacitacionOptions"
                formControlName="participacionCapacitacion"
                placeholder="Seleccione una opción"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="cuantosTrabajos">¿Cuántos trabajos desempeña? </label>
            <input
                type="number"
                pInputText
                formControlName="cuantosTrabajos"
                placeholder="Ingrese el número de trabajos"
            />
        </div>
        <div class="p-field">
            <label for="actividadLaboral"
                >En los últimos 12 meses, ha tenido una actividad laboral:
            </label>
            <p-dropdown
                [options]="actividadLaboralOptions"
                formControlName="actividadLaboral"
                placeholder="Seleccione una opción"
            ></p-dropdown>
        </div>

        <!-- Tabla de Actividades Económicas -->
        <div class="p-field">
            <label>Qué actividades económica a desempeñado?</label>
            <button
                pButton
                type="button"
                icon="pi pi-plus"
                label="Añadir Actividad"
                (click)="showDialogActividadEconomica()"
            ></button>
            <p-table
                [value]="actividadEconomicaList"
                [paginator]="true"
                [rows]="5"
                [responsiveLayout]="'scroll'"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Nombre de la Actividad</th>
                        <th>Acciones</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-actividad>
                    <tr>
                        <td>{{ actividad.nombre }}</td>
                        <td>
                            <button
                                pButton
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning"
                                (click)="editActividadEconomica(actividad)"
                            ></button>
                            <button
                                pButton
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-danger"
                                (click)="deleteActividadEconomica(actividad)"
                            ></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <div class="p-field">
            <label for="relacionDependencia"
                >Trabaja en relación de dependencia?</label
            >
            <p-dropdown
                [options]="relacionDependenciaOptions"
                formControlName="relacionDependencia"
                placeholder="Seleccione una opción"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="cuentaPropia">Trabaja por cuenta propia?</label>
            <p-dropdown
                [options]="cuentaPropiaOptions"
                formControlName="cuentaPropia"
                placeholder="Seleccione una opción"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="ingresosMensuales"
                >Ingresos mensuales promedios del hogar (sumando los ingresos de
                todos los individuos activos)</label
            >
            <p-dropdown
                [options]="ingresosMensualesOptions"
                formControlName="ingresosMensuales"
                placeholder="Seleccione una opción"
            ></p-dropdown>
        </div>

        <div class="p-field">
            <label for="gastosHogar"
                >Repartición de los gastos del hogar:
            </label>
            <button
                pButton
                type="button"
                icon="pi pi-plus"
                label="Añadir Gasto"
                (click)="showDialogGastosHogar()"
            ></button>
            <p-table
                [value]="gastosHogarList"
                [paginator]="true"
                [rows]="5"
                [responsiveLayout]="'scroll'"
            >
                <ng-template pTemplate="header">
                    <tr>
                        <th>Tipo de Gasto</th>
                        <th>Porcentaje</th>
                        <th>Acciones</th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-gasto>
                    <tr>
                        <td>{{ gasto.tipo.label }}</td>
                        <td>{{ gasto.porcentaje }}%</td>
                        <td>
                            <button
                                pButton
                                icon="pi pi-pencil"
                                class="p-button-rounded p-button-warning"
                                (click)="editGastoHogar(gasto)"
                            ></button>
                            <button
                                pButton
                                icon="pi pi-trash"
                                class="p-button-rounded p-button-danger"
                                (click)="deleteGastoHogar(gasto)"
                            ></button>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>

        <div class="p-field">
            <label for="fuentesIngresos"
                >Los ingresos mensuales provienen de:
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="fuentesIngresosOptions"
                formControlName="fuentesIngresos"
                placeholder="Seleccione las fuentes de ingresos"
            ></p-multiSelect>
        </div>
    </p-panel>

    <p-panel
        header="Redes de Apoyo"
        styleClass="mb-3"
        formGroupName="redesDeApoyo"
    >
        <div class="field">
            <label for="actividadesBarrio"
                >Participa en actividades en el barrio</label
            >
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="actividadesBarrioOptions"
                formControlName="actividadesBarrio"
                defaultLabel="Seleccione..."
            >
            </p-multiSelect>
        </div>

        <div class="field">
            <label for="recibeayudaHumanitaria"
                >Recibe algún tipo de ayuda humanitaria?</label
            >
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="recibeAyudaHumanitariaOptions"
                formControlName="recibeayudaHumanitaria"
                defaultLabel="Seleccione..."
            >
            </p-multiSelect>
        </div>

        <div class="field">
            <label for="actividadCantonDentro"
                >En su tiempo libre, que actividades realizan (dentro del
                cantón)</label
            >
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="actividadCantonDentroOptions"
                formControlName="actividadCantonDentro"
                defaultLabel="Seleccione..."
            >
            </p-multiSelect>
        </div>

        <div class="field">
            <label for="actividadCantonFuera"
                >En su tiempo libre, que actividades realizan (fuera del
                cantón)</label
            >
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                [options]="actividadCantonFueraOptions"
                formControlName="actividadCantonFuera"
                defaultLabel="Seleccione..."
            >
            </p-multiSelect>
        </div>

        <div class="field">
            <label for="mejorasBarrio"
                >¿Qué sugiere usted para mejorar su barrio? (Seleccionar 3)
            </label>
            <p-multiSelect
                [filter]="false"
                selectedItemsLabel="{0} seleccionado"
                [maxSelectedLabels]="1"
                selectionLimit="3"
                [options]="mejorasBarrioOptions"
                formControlName="mejorasBarrio"
                defaultLabel="Seleccione..."
            >
            </p-multiSelect>
        </div>

        <div class="field">
            <label for="mejoraPlus"
                >Propuestas adicionales para la mejora del barrio</label
            >
            <input type="text" pInputText formControlName="mejoraPlus" />
        </div>
    </p-panel>

    <button pButton type="submit" label="Registrar"></button>
</form>

<!-- Diálogo para agregar o editar Actividad Económica -->
<p-dialog
    header="Actividad Económica"
    [(visible)]="displayActividadDialog"
    [modal]="true"
    [responsive]="true"
    [style]="{ width: '400px' }"
    [closable]="false"
>
    <div class="p-fluid">
        <div class="p-field">
            <label for="nombreActividad">Nombre de la Actividad</label>
            <input
                type="text"
                pInputText
                [(ngModel)]="actividadActual.nombre"
                placeholder="Ingrese la actividad económica"
            />
        </div>
    </div>
    <p-footer>
        <button
            pButton
            label="Guardar"
            icon="pi pi-check"
            (click)="saveActividadEconomica()"
        ></button>
        <button
            pButton
            label="Cancelar"
            icon="pi pi-times"
            class="p-button-secondary"
            (click)="cancelActividadEconomica()"
        ></button>
    </p-footer>
</p-dialog>

<!-- Diálogo para agregar o editar Gastos del Hogar -->
<p-dialog
    header="Gastos del Hogar"
    [(visible)]="displayGastosDialog"
    [modal]="true"
    [responsive]="true"
    [style]="{ width: '400px' }"
    [closable]="false"
>
    <div class="p-fluid">
        <div class="p-field">
            <label for="tipoGasto">Tipo de Gasto</label>
            <p-dropdown
                appendTo="body"
                [options]="gastosHogarOptions"
                [(ngModel)]="gastoActual.tipo"
                placeholder="Seleccione el tipo de gasto"
                optionLabel="label"
                [ngModelOptions]="{ standalone: true }"
            ></p-dropdown>
        </div>
        <div class="p-field">
            <label for="porcentajeGasto">Porcentaje (%)</label>
            <input
                type="number"
                pInputText
                [min]="0"
                [max]="100"
                [(ngModel)]="gastoActual.porcentaje"
                placeholder="Ingrese el porcentaje"
            />
        </div>
    </div>
    <p-footer>
        <button
            pButton
            label="Guardar"
            icon="pi pi-check"
            (click)="saveGastoHogar()"
            [disabled]="!isFormValid()"
        ></button>
        <button
            pButton
            label="Cancelar"
            icon="pi pi-times"
            class="p-button-secondary"
            (click)="cancelGastoHogar()"
        ></button>
    </p-footer>
</p-dialog>
