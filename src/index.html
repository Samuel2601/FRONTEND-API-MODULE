<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="google-site-verification"
            content="pPADjiXUz7swORMuhRa-2dOuaV4gRjW4UbVjck9nY8A"
        />
        <title>Esmeraldas la Bella</title>
        <base href="/" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover"
        />

        <link rel="icon" type="image/x-icon" href="favicon2.ico" />
        <link
            id="theme-css"
            rel="stylesheet"
            type="text/css"
            href="assets/layout/styles/theme/saga-green/theme.css"
        />
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
        />

        <script src="https://www.google.com/recaptcha/api.js"></script>

        <meta
            name="google-signin-client_id"
            content="489368244321-c2vr1nvlg7qlfo85ttd75poi1c1h0365.apps.googleusercontent.com"
        />
        <meta name="google-signin-scope" content="profile email" />
        <script
            src="https://accounts.google.com/gsi/client"
            async
            defer
        ></script>
    </head>

    <body>
        <app-root></app-root>
        <script src="https://unpkg.com/@googlemaps/js-api-loader@1.x/dist/index.min.js"></script>
        <script>
            // Inicializa el cliente de Google
            window.onload = function () {
                google.accounts.id.initialize({
                    client_id:
                        "700625404417-apcets2tvdf368bquike6ip6hcckgthb.apps.googleusercontent.com", // Reemplaza con tu Client ID de Google
                    callback: handleCredentialResponse, // La función que maneja el token
                });
                google.accounts.id.prompt(); // Muestra el popup de One Tap
            };

            // Función que maneja la respuesta de One Tap
            function handleCredentialResponse(response) {
                console.log("JWT Token:", response.credential);

                // Aquí puedes enviar el token al backend para autenticar al usuario
                fetch("http://localhost:3000/auth/google/one-tap", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json", // Asegura que el contenido es JSON
                    },
                    body: JSON.stringify({
                        credential: response.credential, // El token JWT que obtienes
                    }),
                })
                    .then((response) => {
                        if (!response.ok) {
                            throw new Error(
                                "Error en la solicitud: " + response.status
                            );
                        }
                        return response.json(); // Convierte la respuesta en JSON
                    })
                    .then((data) => {
                        console.log("Server response:", data); // Respuesta del backend
                    })
                    .catch((err) => {
                        console.error("Error:", err); // Maneja cualquier error
                    });
            }
        </script>
    </body>
</html>
