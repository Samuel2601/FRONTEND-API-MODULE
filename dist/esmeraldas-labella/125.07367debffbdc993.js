"use strict";(self.webpackChunkesmeraldas_labella=self.webpackChunkesmeraldas_labella||[]).push([[125],{125:(w,d,a)=>{a.r(d),a.d(d,{RecolectoresMunicipalesModule:()=>k});var m=a(177),f=a(3990),r=a(4523),p=a(5083);const g=(0,p.F3)("Geolocation",{web:()=>a.e(920).then(a.bind(a,2920)).then(i=>new i.GeolocationWeb)});var t=a(4438);const u=(0,p.F3)("Storage",{web:()=>a.e(253).then(a.bind(a,6253)).then(i=>new i.StorageWeb)});var y=a(4412);const v=(0,p.F3)("BackgroundGeolocation");let b=(()=>{class i{constructor(){this.featuredLocationsKey="featuredLocations",this.ubicaciones=new y.t([]),this.iniciarWatcher()}iniciarWatcher(){var o=this;v.addWatcher({backgroundMessage:"Cancela para prevenir drenar tu bater\xeda",backgroundTitle:"Aviso de rastreo",requestPermissions:!0,stale:!0,distanceFilter:10},function(){var n=(0,r.A)(function*(s,c){if(c)return"NOT_AUTHORIZED"===c.code&&window.confirm("Esta aplicaci\xf3n necesita tu ubicaci\xf3n, pero no tiene permiso.\n\n\xbfAbrir configuraci\xf3n ahora?")&&v.openSettings(),console.error(c);const l={lat:s.latitude,lng:s.longitude,timestamp:new Date(s.time).toISOString()};yield o.saveLocation(l),o.ubicaciones.next([...o.ubicaciones.getValue(),l])});return function(s,c){return n.apply(this,arguments)}}()).then(n=>{console.log("Watcher ID:",n)}).catch(n=>{console.error("Error al iniciar el watcher",n)})}saveLocation(o){return(0,r.A)(function*(){const e=yield u.get({key:"locations"}),n=e.value?JSON.parse(e.value):[];n.push(o),yield u.set({key:"locations",value:JSON.stringify(n)})})()}getUbicaciones(){return this.ubicaciones.asObservable()}getFeaturedLocations(){var o=this;return(0,r.A)(function*(){const e=yield u.get({key:o.featuredLocationsKey});return e.value?JSON.parse(e.value):[]})()}getCurrentLocation(){var o=this;return(0,r.A)(function*(){const e=yield u.get({key:o.featuredLocationsKey}),n=e.value?JSON.parse(e.value):[];return n.length>0?n[n.length-1]:null})()}static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275prov=t.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var F=a(1328),L=a(25),M=a(5779),C=a(9880);const S=()=>({"min-width":"50rem"});function A(i,h){1&i&&(t.j41(0,"tr")(1,"th"),t.EFF(2,"Latitud"),t.k0s(),t.j41(3,"th"),t.EFF(4,"Longitud"),t.k0s(),t.j41(5,"th"),t.EFF(6,"Fecha"),t.k0s()())}function R(i,h){if(1&i&&(t.j41(0,"tr")(1,"td"),t.EFF(2),t.k0s(),t.j41(3,"td"),t.EFF(4),t.k0s(),t.j41(5,"td"),t.EFF(6),t.k0s(),t.j41(7,"td"),t.EFF(8),t.nI1(9,"date"),t.k0s()()),2&i){const o=h.$implicit,e=h.rowIndex;t.R7$(2),t.JRh(e+1),t.R7$(2),t.JRh(o.lat),t.R7$(2),t.JRh(o.lng),t.R7$(2),t.JRh(t.i5U(9,4,o.timestamp,"short"))}}let E=(()=>{class i{constructor(o,e,n){this.ubicacionService=o,this.googlemaps=e,this.helper=n,this.table=[],this.polyline=new google.maps.Polyline}ngOnInit(){this.initMap(),this.locationSubscription=this.ubicacionService.getUbicaciones().subscribe(o=>{this.updateMap(o)})}ngOnDestroy(){this.locationSubscription&&this.locationSubscription.unsubscribe()}initMap(){var o=this;return(0,r.A)(function*(){o.googlemaps.getLoader().then((0,r.A)(function*(){o.helper.autocompleteService=new google.maps.places.AutocompleteService,o.helper.geocoderService=new google.maps.Geocoder,o.mapCustom=new google.maps.Map(document.getElementById("map2"),{zoom:15,center:{lat:.977035,lng:-79.655415},mapTypeId:"terrain",fullscreenControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM}}),yield o.getLocation()}))})()}isMobil(){return this.helper.isMobil()}getLocation(){var o=this;return(0,r.A)(function*(){if(o.isMobil()){if(yield g.requestPermissions())return yield g.getCurrentPosition();throw new Error("No se puede ubicater")}return navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var e=(0,r.A)(function*(n){o.latitud=n.coords.latitude,o.longitud=n.coords.longitude,o.addMarker({lat:o.latitud,lng:o.longitud},"Ubicaci\xf3n","Tu ubicaci\xf3n Actual")});return function(n){return e.apply(this,arguments)}}(),e=>{console.error("Error getting location: "+e.message)}):console.error("Geolocation is not supported by this browser."),null})()}addMarker(o,e,n){const c=new google.maps.Marker({position:o,map:this.mapCustom,title:e}),l=new google.maps.InfoWindow({ariaLabel:e,content:n||"Marcador"});l.setPosition(o),l.open(this.mapCustom),c.addListener("click",()=>{l.open(this.mapCustom,c)})}updateMap(o){var e=this;return(0,r.A)(function*(){if(o.forEach(n=>{new google.maps.Marker({position:{lat:n.lat,lng:n.lng},map:e.mapCustom,title:`Lat: ${n.lat}, Lng: ${n.lng}, Time: ${n.timestamp}`})}),e.polyline){const n=e.polyline.getPath();o.forEach(s=>{n.push(new google.maps.LatLng(s.lat,s.lng))})}else{const n=o.map(s=>new google.maps.LatLng(s.lat,s.lng));e.polyline=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}),e.polyline.setMap(e.mapCustom)}e.table=o})()}clearMap(){this.polyline&&(this.polyline.setMap(null),this.polyline=null)}addManualLocation(){var o=this;return(0,r.A)(function*(){const e=yield g.getCurrentPosition();e?yield o.ubicacionService.saveLocation({lat:e.coords.latitude,lng:e.coords.longitude,timestamp:(new Date).toISOString()}):alert("No se pudo obtener la ubicaci\xf3n actual")})()}static#t=this.\u0275fac=function(e){return new(e||i)(t.rXU(b),t.rXU(F.s),t.rXU(L.w))};static#e=this.\u0275cmp=t.VBU({type:i,selectors:[["app-agregar-ubicacion-recolectores"]],decls:7,vars:3,consts:[[1,"map-container"],["id","map2",1,"card",2,"min-height","70vh","margin-left","-18px","margin-right","-18px","margin-bottom","0 !important"],[3,"click"],[3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"]],template:function(e,n){1&e&&(t.j41(0,"div",0),t.nrm(1,"div",1),t.j41(2,"button",2),t.bIt("click",function(){return n.addManualLocation()}),t.EFF(3,"Agregar Ubicaci\xf3n Manual"),t.k0s()(),t.j41(4,"p-table",3),t.DNE(5,A,7,0,"ng-template",4)(6,R,10,7,"ng-template",5),t.k0s()),2&e&&(t.R7$(4),t.Y8G("value",n.table)("tableStyle",t.lJ4(2,S)))},dependencies:[M.Ei,C.XI,m.vh]})}return i})(),T=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275mod=t.$C({type:i});static#o=this.\u0275inj=t.G2t({imports:[f.iI.forChild([{path:"map",component:E}]),f.iI]})}return i})();var O=a(8038);let k=(()=>{class i{static#t=this.\u0275fac=function(e){return new(e||i)};static#e=this.\u0275mod=t.$C({type:i});static#o=this.\u0275inj=t.G2t({imports:[T,m.MD,O.L]})}return i})()}}]);