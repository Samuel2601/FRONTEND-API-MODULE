"use strict";(self.webpackChunkesmeraldas_labella=self.webpackChunkesmeraldas_labella||[]).push([[873],{6873:(D,f,r)=>{r.r(f),r.d(f,{RecolectoresMunicipalesModule:()=>O});var d=r(6708),P=r(1761),g=r(4516),u=r(6509);const p=(0,u.F3)("Geolocation",{web:()=>r.e(102).then(r.bind(r,7102)).then(o=>new o.GeolocationWeb)});var a=r(9573);const b=(0,u.F3)("Preferences",{web:()=>r.e(843).then(r.bind(r,8843)).then(o=>new o.PreferencesWeb)});var v=r(8625);const y=(0,u.F3)("BackgroundGeolocation");let C=(()=>{class o{constructor(){this.ubicaciones=new v.t([]),this.velocidadActual=new v.t(0),this.lastUpdateTimestamp=null,this.MAX_DISTANCE_KM=.001,this.MIN_SPEED_KMH=120}iniciarWatcher(){var e=this;y.addWatcher({backgroundMessage:"Cancela para prevenir drenar tu bater\xeda",backgroundTitle:"Aviso de rastreo",requestPermissions:!0,stale:!0,distanceFilter:40},function(){var n=(0,g.A)(function*(i,c){if(c)return"NOT_AUTHORIZED"===c.code&&window.confirm("Esta aplicaci\xf3n necesita tu ubicaci\xf3n, pero no tiene permiso.\n\n\xbfAbrir configuraci\xf3n ahora?")&&y.openSettings(),console.error(c);e.velocidadActual.next(i.speed||0);const l=Date.now(),m={lat:i.latitude,lng:i.longitude,timestamp:(new Date).toISOString(),speed:i.speed?3.6*i.speed:0,destacado:!1},M=e.isValidLocation(m,l);M&&(yield e.saveLocation(m,M),e.ubicaciones.next([...e.ubicaciones.getValue(),m]),e.lastUpdateTimestamp=l)});return function(i,c){return n.apply(this,arguments)}}()).then(n=>{console.log("Watcher ID:",n)}).catch(n=>{console.error("Error al iniciar el watcher",n)})}isValidLocation(e,t){t=t||Date.now();const n=this.ubicaciones.getValue().slice(-1)[0];if(!n)return!0;const i=this.calculateDistance(n,e);return console.log("La distancia al \xfaltimo punto: ",i),i>0&&i<=this.MIN_SPEED_KMH*((t-this.lastUpdateTimestamp)/1e3/3600)&&i<=1e3*this.MAX_DISTANCE_KM}calculateDistance(e,t){const i=e.lat*Math.PI/180,c=t.lat*Math.PI/180,s=(t.lat-e.lat)*Math.PI/180,l=(t.lng-e.lng)*Math.PI/180,m=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(c)*Math.sin(l/2)*Math.sin(l/2);return 2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m))*6371e3}saveLocation(e,t){var n=this;return(0,g.A)(function*(){if(t=t||n.isValidLocation(e)){const i=yield b.get({key:"locations"}),c=i.value?JSON.parse(i.value):[];c.push(e),yield b.set({key:"locations",value:JSON.stringify(c)}),n.ubicaciones.next([...n.ubicaciones.getValue(),e])}})()}getUbicaciones(){return this.ubicaciones.asObservable()}getVelocidadActual(){return this.velocidadActual.asObservable()}static#t=this.\u0275fac=function(t){return new(t||o)};static#e=this.\u0275prov=a.jDH({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var L=r(4530),I=r(9033),A=r(2353),T=r(7403),w=r(8629);const F=()=>({"min-width":"50rem"});function S(o,h){1&o&&(a.j41(0,"tr")(1,"th"),a.EFF(2,"Latitud"),a.k0s(),a.j41(3,"th"),a.EFF(4,"Longitud"),a.k0s(),a.j41(5,"th"),a.EFF(6,"Fecha"),a.k0s()())}function E(o,h){if(1&o&&(a.j41(0,"tr")(1,"td"),a.EFF(2),a.k0s(),a.j41(3,"td"),a.EFF(4),a.k0s(),a.j41(5,"td"),a.EFF(6),a.k0s(),a.j41(7,"td"),a.EFF(8),a.nI1(9,"date"),a.k0s()()),2&o){const e=h.$implicit,t=h.rowIndex;a.R7$(2),a.JRh(t+1),a.R7$(2),a.JRh(e.lat),a.R7$(2),a.JRh(e.lng),a.R7$(2),a.JRh(a.i5U(9,4,e.timestamp,"short"))}}let $=(()=>{class o{constructor(e,t,n){this.ubicacionService=e,this.googlemaps=t,this.helper=n,this.velocidad=0,this.datos=[{lat:.9657655,lng:-79.6550148,timestamp:"7/30/24, 1:02 PM"},{lat:.9656814,lng:-79.6551387,timestamp:"7/30/24, 1:03 PM"},{lat:.9658164,lng:-79.6547029,timestamp:"7/30/24, 1:04 PM"},{lat:.9662421,lng:-79.6544553,timestamp:"7/30/24, 1:08 PM"},{lat:.9667238,lng:-79.6545723,timestamp:"7/30/24, 1:08 PM"},{lat:.9671889,lng:-79.6546772,timestamp:"7/30/24, 1:08 PM"},{lat:.9676337,lng:-79.6548404,timestamp:"7/30/24, 1:09 PM"},{lat:.968116,lng:-79.6549069,timestamp:"7/30/24, 1:09 PM"},{lat:.9685813,lng:-79.6550088,timestamp:"7/30/24, 1:09 PM"},{lat:.9690244,lng:-79.6551084,timestamp:"7/30/24, 1:09 PM"},{lat:.9695065,lng:-79.6552827,timestamp:"7/30/24, 1:09 PM"},{lat:.9699516,lng:-79.6553655,timestamp:"7/30/24, 1:10 PM"},{lat:.9701353,lng:-79.6549497,timestamp:"7/30/24, 1:10 PM"},{lat:.9702491,lng:-79.6545127,timestamp:"7/30/24, 1:10 PM"},{lat:.970369,lng:-79.6540486,timestamp:"7/30/24, 1:11 PM"},{lat:.9704433,lng:-79.6535755,timestamp:"7/30/24, 1:11 PM"},{lat:.9705558,lng:-79.6531107,timestamp:"7/30/24, 1:12 PM"},{lat:.9710168,lng:-79.6530569,timestamp:"7/30/24, 1:12 PM"},{lat:.9714914,lng:-79.6531824,timestamp:"7/30/24, 1:13 PM"},{lat:.9719769,lng:-79.6532784,timestamp:"7/30/24, 1:13 PM"},{lat:.9724389,lng:-79.6533848,timestamp:"7/30/24, 1:13 PM"},{lat:.9729243,lng:-79.6535011,timestamp:"7/30/24, 1:13 PM"},{lat:.9733678,lng:-79.6536393,timestamp:"7/30/24, 1:13 PM"},{lat:.9738032,lng:-79.6537938,timestamp:"7/30/24, 1:14 PM"},{lat:.9742861,lng:-79.6539687,timestamp:"7/30/24, 1:14 PM"},{lat:.9747995,lng:-79.6541088,timestamp:"7/30/24, 1:14 PM"},{lat:.975276,lng:-79.6541938,timestamp:"7/30/24, 1:14 PM"},{lat:.9757744,lng:-79.6542966,timestamp:"7/30/24, 1:14 PM"},{lat:.9762746,lng:-79.6544358,timestamp:"7/30/24, 1:14 PM"},{lat:.976744,lng:-79.6545407,timestamp:"7/30/24, 1:14 PM"},{lat:.976968,lng:-79.6549409,timestamp:"7/30/24, 1:15 PM"},{lat:.9769976,lng:-79.6553911,timestamp:"7/30/24, 1:16 PM"},{lat:.9766302,lng:-79.655677,timestamp:"7/30/24, 1:17 PM"},{lat:.9770762,lng:-79.6555332,timestamp:"7/30/24, 1:19 PM"},{lat:.9770968,lng:-79.6550571,timestamp:"7/30/24, 1:19 PM"},{lat:.9768853,lng:-79.6544926,timestamp:"7/30/24, 1:20 PM"},{lat:.9769662,lng:-79.6553117,timestamp:"7/30/24, 1:20 PM"},{lat:.9764872,lng:-79.6555229,timestamp:"7/30/24, 1:20 PM"},{lat:.9769044,lng:-79.6556998,timestamp:"7/30/24, 1:20 PM"},{lat:.9770357,lng:-79.655264,timestamp:"7/30/24, 1:32 PM"},{lat:.9774043,lng:-79.6555747,timestamp:"7/30/24, 1:33 PM"},{lat:.9769443,lng:-79.6553905,timestamp:"7/30/24, 1:46 PM"},{lat:.9764942,lng:-79.6553199,timestamp:"7/30/24, 1:50 PM"},{lat:.976054,lng:-79.6554236,timestamp:"7/30/24, 1:51 PM"},{lat:.9758303,lng:-79.6558173,timestamp:"7/30/24, 1:52 PM"},{lat:.975865,lng:-79.6553301,timestamp:"7/30/24, 1:53 PM"},{lat:.9755674,lng:-79.6549895,timestamp:"7/30/24, 1:54 PM"},{lat:.9750194,lng:-79.654835,timestamp:"7/30/24, 1:54 PM"},{lat:.9745433,lng:-79.6546496,timestamp:"7/30/24, 1:54 PM"},{lat:.9740408,lng:-79.6545743,timestamp:"7/30/24, 1:54 PM"},{lat:.9735554,lng:-79.6545037,timestamp:"7/30/24, 1:55 PM"},{lat:.9731167,lng:-79.6543455,timestamp:"7/30/24, 1:55 PM"},{lat:.9726613,lng:-79.6542209,timestamp:"7/30/24, 1:55 PM"},{lat:.9721611,lng:-79.6541068,timestamp:"7/30/24, 1:55 PM"},{lat:.971677,lng:-79.6539579,timestamp:"7/30/24, 1:55 PM"},{lat:.9712046,lng:-79.653855,timestamp:"7/30/24, 1:55 PM"},{lat:.9707102,lng:-79.6537388,timestamp:"7/30/24, 1:55 PM"},{lat:.9702403,lng:-79.6536607,timestamp:"7/30/24, 1:55 PM"},{lat:.969767,lng:-79.6536031,timestamp:"7/30/24, 1:55 PM"},{lat:.9692762,lng:-79.6535112,timestamp:"7/30/24, 1:56 PM"},{lat:.9688127,lng:-79.6534455,timestamp:"7/30/24, 1:56 PM"},{lat:.9683185,lng:-79.6533216,timestamp:"7/30/24, 1:56 PM"},{lat:.9678255,lng:-79.6532761,timestamp:"7/30/24, 1:56 PM"},{lat:.9673441,lng:-79.6531672,timestamp:"7/30/24, 1:56 PM"},{lat:.9668359,lng:-79.6530719,timestamp:"7/30/24, 1:56 PM"},{lat:.9663465,lng:-79.6530072,timestamp:"7/30/24, 1:56 PM"},{lat:.965862,lng:-79.6528747,timestamp:"7/30/24, 1:56 PM"}],this.table=[],this.polyline=new google.maps.Polyline,this.pathson=[]}ngOnInit(){var e=this;return(0,g.A)(function*(){yield e.initMap(),e.locationSubscription=e.ubicacionService.getUbicaciones().subscribe(t=>{e.updateMap(t)}),e.ubicacionService.getVelocidadActual().subscribe(t=>{e.velocidad=3.6*t}),setInterval(()=>{e.addManualLocation(!1)},5e3)})()}ngOnDestroy(){this.locationSubscription&&this.locationSubscription.unsubscribe()}initMap(){var e=this;return(0,g.A)(function*(){const t=yield e.getLocation();e.googlemaps.getLoader().then((0,g.A)(function*(){e.mapCustom=new google.maps.Map(document.getElementById("map2"),{zoom:15,center:t,mapTypeId:"terrain",fullscreenControl:!1,mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.LEFT_BOTTOM},draggable:!0,scrollwheel:!1,disableDoubleClickZoom:!0,gestureHandling:"cooperative"})}))})()}isMobil(){return this.helper.isMobil()}getLocation(){var e=this;return(0,g.A)(function*(){if(e.isMobil()){if(yield p.requestPermissions()){const n=yield p.getCurrentPosition();return{lat:n.coords.latitude,lng:n.coords.longitude}}return{lat:.977035,lng:-79.655415}}return{lat:.977035,lng:-79.655415}})()}marquerLocation(){var e=this;return(0,g.A)(function*(){if(e.isMobil()){if(!(yield p.requestPermissions()))throw new Error("No se puede ubicater");{const n=yield p.getCurrentPosition();e.addMarker({lat:n.coords.latitude,lng:n.coords.longitude},"Ubicaci\xf3n","Tu ubicaci\xf3n Actual")}}else{if(!navigator.geolocation)throw new Error("No se puede ubicater");navigator.geolocation.getCurrentPosition(function(){var t=(0,g.A)(function*(n){e.latitud=n.coords.latitude,e.longitud=n.coords.longitude,e.addMarker({lat:e.latitud,lng:e.longitud},"Ubicaci\xf3n","Tu ubicaci\xf3n Actual")});return function(n){return t.apply(this,arguments)}}(),t=>{console.error("Error getting location: "+t.message)})}})()}addMarker(e,t,n){const c=new google.maps.Marker({position:e,map:this.mapCustom,title:t}),s=new google.maps.InfoWindow({ariaLabel:t,content:n||"Marcador"});s.setPosition(e),s.open(this.mapCustom),c.addListener("click",()=>{s.open(this.mapCustom,c)})}updateMap(e){var t=this;return(0,g.A)(function*(){const n=["#2196f3","#f57c00","#3f51b5","#009688","#f57c00","#9c27b0","#ff4032","#4caf50"];t.pathson.length>0&&t.pathson.forEach(l=>{l.setMap(null)}),t.pathson=[];const i=[];e.forEach(l=>{i.push({lat:l.lat,lng:l.lng})});const c=new google.maps.Polyline({path:i,geodesic:!0,strokeColor:n[i.length%n.length],strokeOpacity:1,strokeWeight:6});c.addListener("click",l=>{const m=new google.maps.InfoWindow({content:"Tu recorrido"});m.setPosition(l.latLng),m.open(t.mapCustom)}),c.setMap(t.mapCustom),t.pathson.push(c);const s=e[0];if(t.inicial)t.inicial.setPosition({lat:s.lat,lng:s.lng});else{t.inicial=new google.maps.Marker({position:{lat:s.lat,lng:s.lng},map:t.mapCustom,title:`Lat: ${s.lat}, Lng: ${s.lng}, Time: ${s.timestamp}`});const l=new google.maps.InfoWindow({content:`<div><strong>Inicio</strong><br>Lat: ${s.lat}, Lng: ${s.lng}<br>Time: ${s.timestamp}</div>`});t.inicial.addListener("click",()=>{l.open(t.mapCustom,t.inicial)})}if(e.length>3){const l=e[e.length-1];if(t.final)t.final.setPosition({lat:l.lat,lng:l.lng});else{t.final=new google.maps.Marker({position:{lat:l.lat,lng:l.lng},map:t.mapCustom,title:`Lat: ${l.lat}, Lng: ${l.lng}, Time: ${l.timestamp}`});const m=new google.maps.InfoWindow({content:`<div><strong>Fin</strong><br>Lat: ${l.lat}, Lng: ${l.lng}<br>Time: ${l.timestamp}</div>`});t.final.addListener("click",()=>{m.open(t.mapCustom,t.final)})}}t.table=e})()}clearMap(){this.polyline&&(this.polyline.setMap(null),this.polyline=null)}addManualLocation(e){var t=this;return(0,g.A)(function*(){const n=yield p.getCurrentPosition(),i={lat:n.coords.latitude,lng:n.coords.longitude,timestamp:(new Date).toISOString(),speed:0,destacado:e},c=t.ubicacionService.isValidLocation(i);if(c){if(e){const s=new google.maps.Marker({position:{lat:i.lat,lng:i.lng},map:t.mapCustom,title:`DESTACADO, Time: ${(new Date).toISOString()}`}),l=new google.maps.InfoWindow({content:`<div><strong>Marcador destacado</strong><br>Lat: ${i.lat}, Lng: ${i.lng}<br>Time: ${(new Date).toISOString()}</div>`});s.addListener("click",()=>{l.open(t.mapCustom,s)})}n?yield t.ubicacionService.saveLocation(i,c):alert("No se pudo obtener la ubicaci\xf3n actual")}})()}static#t=this.\u0275fac=function(t){return new(t||o)(a.rXU(C),a.rXU(L.s),a.rXU(I.w))};static#e=this.\u0275cmp=a.VBU({type:o,selectors:[["app-agregar-ubicacion-recolectores"]],decls:12,vars:7,consts:[[1,"map-container"],["id","map2",1,"card",2,"min-height","70vh","margin-left","-18px","margin-right","-18px","margin-bottom","0 !important"],[1,"velocidad-container"],[1,"velocidad-value"],["icon","pi pi-plus","label","Agregar Ubicaci\xf3n Manual",3,"onClick"],[3,"value","tableStyle"],["pTemplate","header"],["pTemplate","body"]],template:function(t,n){1&t&&(a.j41(0,"div",0),a.nrm(1,"div",1),a.j41(2,"div",2)(3,"h3"),a.EFF(4,"Velocidad Actual"),a.k0s(),a.j41(5,"p",3),a.EFF(6),a.nI1(7,"number"),a.k0s(),a.j41(8,"p-button",4),a.bIt("onClick",function(){return n.addManualLocation(!0)}),a.k0s()()(),a.j41(9,"p-table",5),a.DNE(10,S,7,0,"ng-template",6)(11,E,10,7,"ng-template",7),a.k0s()),2&t&&(a.R7$(6),a.SpI("",a.i5U(7,3,n.velocidad,"1.0-2")," km/h"),a.R7$(3),a.Y8G("value",n.table)("tableStyle",a.lJ4(6,F)))},dependencies:[A.Ei,T.$n,w.XI,d.QX,d.vh],styles:[".velocidad-container[_ngcontent-%COMP%]{padding:20px;border:1px solid #ddd;border-radius:8px;background-color:#f9f9f9;text-align:center}.velocidad-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px;font-size:1.2em;color:#333}.velocidad-value[_ngcontent-%COMP%]{font-size:2em;color:#1e90ff}"]})}return o})(),k=(()=>{class o{static#t=this.\u0275fac=function(t){return new(t||o)};static#e=this.\u0275mod=a.$C({type:o});static#a=this.\u0275inj=a.G2t({imports:[P.iI.forChild([{path:"map",component:$}]),P.iI]})}return o})();var R=r(6967);let O=(()=>{class o{static#t=this.\u0275fac=function(t){return new(t||o)};static#e=this.\u0275mod=a.$C({type:o});static#a=this.\u0275inj=a.G2t({imports:[k,d.MD,R.L]})}return o})()}}]);